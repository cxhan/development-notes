---
title: 2023-02-06
---

## MutationObserver

æœ€è¿‘åœ¨æ˜é‡‘ä¸Šåˆ·åˆ°ä¸€ä¸ªé¢è¯•é¢˜ï¼ˆ**SPAåº”ç”¨å¦‚ä½•é‡‡é›†è·¯ç”±åˆ‡æ¢æ€§èƒ½**ï¼‰

æˆ‘å½“æ—¶å¿ƒæƒ³è¿™ä¸ªä¸å°±æ˜¯ç›‘å¬è·¯ç”±å˜åŒ–çš„æ—¶é—´å‘¨æœŸå—ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è·¯ç”±çš„å…¨å±€å®ˆå«ä¸­è¿›è¡Œè®¾ç½®ï¼Œè­¬å¦‚åœ¨ä¸Šä¸€ä¸ªè·¯ç”±leaveå’Œä¸‹ä¸€ä¸ªè·¯ç”±enterçš„æ—¶å€™æ‰“ä¸¤ä¸ªtagï¼Œä¸¤ä¸ªtagå¯¹åº”çš„æ—¶é—´å·®å°±æ˜¯è·¯ç”±åˆ‡æ¢çš„è€—æ—¶ï¼Œä¸è¿‡è¿™é‡Œè¦æ³¨æ„ä¸‹ä¸€è·¯ç”±enterçš„æ—¶å€™å…¶å®DOMæ˜¯æ²¡æœ‰å®Œå…¨åŠ è½½å¥½çš„ï¼Œæ‰€ä»¥è¦åœ¨DOMå®Œå…¨loadedä¹‹åå†è®¡ç®—æ—¶é—´ã€‚ï¼ˆè¿™ä¸ªåªæ˜¯æˆ‘ç²—æµ…çš„è§è§£ï¼Œå¤§ä½¬çš„æ–¹æ¡ˆå¦‚ä¸‹ï¼‰ã€‚

å…¶å®æµè§ˆå™¨å¾ˆæ—©å°±æœ‰ä¸€ä¸ªå«**Mutation Events**çš„apiå¯ä»¥ç”¨æ¥ç›‘å¬domçš„å˜åŒ–ï¼Œä½†æ˜¯æ€§èƒ½å’Œå…¼å®¹æ€§é—®é¢˜éƒ½ä¸å¤ªå¥½ï¼Œæ‰€ä»¥è¿™ä¸ªapiåæ¥å°±å¼ƒç”¨äº†ï¼Œä¸è¿‡æ–°è§„èŒƒè¿­ä»£å¢åŠ äº†ä¸€ä¸ª**MutationObserver**çš„apiä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½ï¼Œç°åœ¨æµè§ˆå™¨(IE11+)ç›®å‰éƒ½æ”¯æŒè¯¥apiï¼Œå¯ä»¥å°è¯•ç”¨ä¸€ä¸‹ï¼Œæ®è¯´è¿›è¡Œäº†æ€§èƒ½çš„ä¼˜åŒ–ï¼Œå¯¹æµè§ˆå™¨ä¹Ÿä¸ä¼šæœ‰å¤ªå¤šçš„è´Ÿè·ï¼Œæ€ä¹ˆä¼˜åŒ–çš„ç¬”è€…ä¹Ÿä¸çŸ¥é“ğŸ¶ã€‚

è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š

```javascript
const observer = new MutationObserver(callback)
observer.observe(elements, config)
```

å…¶ä¸­**callback**æ˜¯ç›‘å¬åˆ°domå˜åŒ–çš„å›è°ƒï¼Œelementæ˜¯è¦ç›‘å¬çš„domï¼Œconfigæ˜¯ç›‘å¬å™¨çš„å…·ä½“é…ç½®

MutationObserverå¯¹è±¡å®ä¾‹æœ‰å¦‚ä¸‹çš„æ–¹æ³•ï¼š

|  æ–¹æ³•   | åŠŸèƒ½  |
|  ----  | ----  |
| **disconnect**  | é˜»æ­¢MutationObserverå®ä¾‹ç»§ç»­æ¥æ”¶é€šçŸ¥ï¼Œç›´åˆ°å†æ¬¡è°ƒç”¨å…¶observe()æ–¹æ³•ï¼Œè¯¥è§‚å¯Ÿè€…å¯¹è±¡åŒ…å«çš„å›è°ƒå‡½æ•°éƒ½ä¸ä¼šå†è¢«è°ƒç”¨ |
| **observe**  | å¯åŠ¨ç›‘å¬ï¼Œobserve(target, config) |
| takeRecords | ä»MutationObserverçš„é€šçŸ¥é˜Ÿåˆ—ä¸­åˆ é™¤æ‰€æœ‰å¾…å¤„ç†çš„é€šçŸ¥ï¼Œå¹¶å°†å®ƒä»¬è¿”å›åˆ°MutationRecordå¯¹è±¡çš„æ–°Arrayä¸­ |

configé…ç½®å‚æ•°ï¼š

|  å±æ€§   | è¯´æ˜  |
|  ----  | ----  |
| **attributes**  | è®¾ä¸º true ä»¥è§‚å¯Ÿå—ç›‘è§†å…ƒç´ çš„å±æ€§å€¼å˜æ›´ï¼Œé»˜è®¤å€¼false |
| **attributeFilter**  | è¦ç›‘è§†çš„ç‰¹å®šå±æ€§åç§°çš„æ•°ç»„ã€‚å¦‚æœæœªåŒ…å«æ­¤å±æ€§ï¼Œåˆ™å¯¹æ‰€æœ‰å±æ€§çš„æ›´æ”¹éƒ½ä¼šè§¦å‘å˜åŠ¨é€šçŸ¥ |
| characterData | è®¾ä¸º true ï¼Œä»¥ç›‘è§†æŒ‡å®šç›®æ ‡èŠ‚ç‚¹æˆ–å­èŠ‚ç‚¹æ ‘ä¸­èŠ‚ç‚¹æ‰€åŒ…å«çš„å­—ç¬¦æ•°æ®çš„å˜åŒ– |
| childList | è®¾ä¸º true ï¼Œä»¥ç›‘è§†ç›®æ ‡èŠ‚ç‚¹åŠå…¶å­èŠ‚ç‚¹ï¼Œé»˜è®¤å€¼ä¸º false |
| subtree | è®¾ä¸º true ï¼Œä»¥ç›‘è§†ç›®æ ‡èŠ‚ç‚¹åŠå…¶å­å­™èŠ‚ç‚¹ï¼Œé»˜è®¤å€¼ä¸º false |

è¦ç›‘å¬ä¸€ä¸ªidä¸ºtestçš„buttonçš„classå˜åŒ–åªè¦å¦‚ä¸‹çš„ä»£ç å³å¯å®Œæˆ

```javascript
const observer = new MutationObserver((mutations) => {
    console.log(mutations)
})
observer.observe(document.querySelector('#test'), {attributes: true, attributeFilter: ['class']})
document.querySelector('#test').setAttribute('class', 'test123')
// è¿™ä¸ªæ—¶å€™ç›‘å¬å™¨å°±ä¼šåé¦ˆclassçš„å˜åŒ–ï¼Œæ‰“å°å‡ºçš„mutationsæ˜¯ä¸€ä¸ªMutationRecordå®ä¾‹ï¼Œå…¶ä¸­çš„targetå°±æ˜¯æ–°çš„element
```

å›åˆ°æ­£é¢˜ï¼Œè¦ç›‘å¬è·¯ç”±å˜åŒ–çš„æ€§èƒ½ï¼Œå’Œä¸Šé¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œåœ¨SPAä¸­ä¸€ä¸ªè·¯ç”±å°±æ˜¯å¯¹åº”çš„ä¸€ä¸ªdomï¼Œå¯èƒ½å°±æ˜¯idä¸ºappçš„domçš„ç›´æ¥childï¼Œé‚£æˆ‘ä»¬å°±ç›‘å¬è¿™ä¸ªdomå°±å¯ä»¥äº†ï¼Œç„¶åè®¡ç®—MutationObserverç›‘å¬DOMå¼€å§‹å˜åŒ–åˆ°ç¨³å®šçš„æ—¶é—´å·®å°±å¯ä»¥è®¤ä¸ºæ˜¯è·¯ç”±åˆ‡æ¢æ€§èƒ½çš„ä½“ç°ã€‚

Well Doneï¼åˆæ˜¯é•¿è§è¯†çš„ä¸€å¤©ï¼ŒğŸ˜ğŸ˜ğŸ˜ï¼

<a href="https://github.com/cxhan" target="_blank"><img src="../../assets/logo.png" style="max-width: 600px;margin: 0 auto;display: block;"/></a>
